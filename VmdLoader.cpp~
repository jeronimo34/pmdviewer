#include "VmdLoader.h"
#include <ostream>
#include <istream>
#include <fstream>

#include <iostream>

CVmdLoader::CVmdLoader(const char* filename){

// PMDファイルからPMDデータを抽出
  ifstream ifs(filename, ios::binary);
  if (ifs.fail()) throw "cannot find file.";
  char hoge[50];
  ifs.read(hoge, 50);
  int numVmdMotion = 0;
  ifs.read((char*)&numVmdMotion, 4);
  vmdMotions.resize(numVmdMotion);

  for(int i = 0; i < (int)vmdMotions.size(); ++i){
    VmdMotion v;
    ifs.read(v.boneName, 15);
    ifs.read((char*)&v.flameNo, sizeof(float));
    ifs.read((char*)&v.location[0], sizeof(float) * 3);
    ifs.read((char*)&v.rotation[0], sizeof(float) * 4);
    ifs.read((char*)&v.interpolation[0], 64);
    vmdMotions[i] = v;
  }

  ifs.close();
}


CVmdLoader::~CVmdLoader() {

  while(!vmdMotions.empty())
    vmdMotions.pop_back();
  cout << "koko" << endl;
}

  VmdHeader CVmdLoader::GetHeader() {
    return vmdHeader;
  }
  vector<VmdMotion> CVmdLoader::GetMotions() const {
    return vmdMotions;
  }

